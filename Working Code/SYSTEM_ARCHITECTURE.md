# System Architecture - PS/2 Mouse VGA Drawing System

## Block Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DRAWING_SYSTEM (Top Level)                          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PS/2 MOUSE  â”‚â”€â”€â”€â”€â–¶â”‚ Mouse Parser â”‚â”€â”€â”€â”€â–¶â”‚   Drawing State Machine  â”‚  â”‚
â”‚  â”‚  (Hardware)   â”‚     â”‚              â”‚     â”‚  â€¢ Track cursor position â”‚  â”‚
â”‚  â”‚               â”‚     â”‚  â€¢ 3-byte    â”‚     â”‚  â€¢ Handle buttons        â”‚  â”‚
â”‚  â”‚  J7 Port      â”‚     â”‚    packets   â”‚     â”‚  â€¢ Draw/Erase pixels     â”‚  â”‚
â”‚  â”‚               â”‚     â”‚  â€¢ Delta X/Y â”‚     â”‚  â€¢ Clear screen          â”‚  â”‚
â”‚  â”‚               â”‚     â”‚  â€¢ Buttons   â”‚     â”‚  â€¢ Redraw cursor         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â–²                                               â”‚                   â”‚
â”‚         â”‚                                               â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ PS2_Controller â”‚                          â”‚  VGA Write Signals â”‚        â”‚
â”‚  â”‚                â”‚                          â”‚  â€¢ X, Y coordinatesâ”‚        â”‚
â”‚  â”‚ â€¢ Initialize   â”‚                          â”‚  â€¢ Color (9-bit)   â”‚        â”‚
â”‚  â”‚ â€¢ Send/Receive â”‚                          â”‚  â€¢ Write enable    â”‚        â”‚
â”‚  â”‚ â€¢ Protocol FSM â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚                   â”‚
â”‚                                                          â–¼                   â”‚
â”‚                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚    VGA Adapter           â”‚    â”‚
â”‚  â”‚                                          â”‚                          â”‚    â”‚
â”‚  â”‚  CLOCK_50 (50 MHz)                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚                                          â”‚  â”‚ Dual-Port Memory   â”‚ â”‚    â”‚
â”‚  â”‚                                          â”‚  â”‚  320Ã—240Ã—9 bits    â”‚ â”‚    â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚                    â”‚ â”‚    â”‚
â”‚  â”‚         â”‚  VGA PLL    â”‚                 â”‚  â”‚ Port A: Write      â”‚ â”‚    â”‚
â”‚  â”‚         â”‚  50â†’25 MHz  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  â”‚ Port B: Read (VGA) â”‚ â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                          â”‚            â”‚            â”‚    â”‚
â”‚  â”‚                                          â”‚            â–¼            â”‚    â”‚
â”‚  â”‚                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚                                          â”‚  â”‚  VGA Controller    â”‚ â”‚    â”‚
â”‚  â”‚                                          â”‚  â”‚  â€¢ Timing Gen      â”‚ â”‚    â”‚
â”‚  â”‚                                          â”‚  â”‚  â€¢ Sync Signals    â”‚ â”‚    â”‚
â”‚  â”‚                                          â”‚  â”‚  â€¢ Color Expand    â”‚ â”‚    â”‚
â”‚  â”‚                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚                                                     â”‚                    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚    â”‚                                                                     â”‚
â”‚  â”‚    â–¼                                                                     â”‚
â”‚  â”‚  VGA Monitor (640Ã—480 @ 60Hz)                                           â”‚
â”‚  â”‚  â€¢ 8-bit Red, Green, Blue                                               â”‚
â”‚  â”‚  â€¢ H-Sync, V-Sync                                                       â”‚
â”‚  â”‚  â€¢ Blank, Sync, Clock                                                   â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”‚  Debug Outputs:                                                         â”‚
â”‚  â”‚  â€¢ HEX0-HEX3: Cursor coordinates                                        â”‚
â”‚  â”‚  â€¢ LEDR[0-6]: Button states and status                                 â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”‚  User Controls:                                                         â”‚
â”‚  â”‚  â€¢ KEY[0]: Reset (active low)                                          â”‚
â”‚  â”‚  â€¢ SW[9]: Clear screen                                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
PS/2 Mouse Movement
        â”‚
        â–¼
   [PS2_CLK/DAT signals]
        â”‚
        â–¼
   PS2_Controller
   â€¢ Reads bytes
   â€¢ Sends init command (0xF4)
        â”‚
        â–¼
   [8-bit data stream]
        â”‚
        â–¼
   PS2_Mouse_Parser
   â€¢ Validates packets
   â€¢ Extracts data
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼              â–¼
   [delta_x]    [delta_y]      [buttons[2:0]]
        â”‚             â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            Drawing State Machine
            â€¢ Update cursor position
            â€¢ Check boundaries
            â€¢ Decide action based on buttons
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
    [IDLE]     [DRAW_PIXEL]  [DRAW_CURSOR]
                     â”‚
                     â–¼
              [vga_x, vga_y, vga_color, vga_write]
                     â”‚
                     â–¼
               VGA Adapter
               â€¢ Write to memory
                     â”‚
                     â–¼
              Dual-Port RAM
              â€¢ Stores pixel colors
                     â”‚
                     â–¼
              VGA Controller
              â€¢ Reads pixels
              â€¢ Generates sync
                     â”‚
                     â–¼
               VGA Display
```

## State Machine Diagram

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”Œâ”€â”€â”€â–¶â”‚   IDLE   â”‚â—€â”€â”€â”€â”
                    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚         â”‚          â”‚
                    â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    Cursor moved?         Buttons?
        â”‚                    â”‚                      â”‚
        â”‚                    â–¼                      â–¼
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚ CLEAR_OLD_CURSOR  â”‚    â”‚  DRAW_PIXEL   â”‚
        â”‚         â”‚                   â”‚    â”‚               â”‚
        â”‚         â”‚  Erase 21Ã—21      â”‚    â”‚  Draw 2Ã—2     â”‚
        â”‚         â”‚  cross at old pos â”‚    â”‚  at cursor    â”‚
        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                      â”‚
        â”‚                   â–¼                      â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
        â”‚         â”‚   DRAW_CURSOR     â”‚            â”‚
        â”‚         â”‚                   â”‚            â”‚
        â”‚         â”‚  Draw 21Ã—21       â”‚            â”‚
        â”‚         â”‚  cross at new pos â”‚            â”‚
        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
        â”‚                   â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                       SW[9] high?
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ CLEARING_SCREEN  â”‚
                   â”‚                  â”‚
                   â”‚  Write black to  â”‚
                   â”‚  all 76,800 px   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Memory Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Video Memory (Dual-Port RAM)            â”‚
â”‚         320 Ã— 240 Ã— 9 bits = 691,200 bits      â”‚
â”‚                                                â”‚
â”‚  Port A (Write Side) â—„â”€â”€ Drawing State Machineâ”‚
â”‚  â€¢ Clock: CLOCK_50 (50 MHz)                   â”‚
â”‚  â€¢ Address: [16:0] from (X, Y)                â”‚
â”‚  â€¢ Data In: 9-bit color                       â”‚
â”‚  â€¢ Write Enable: from drawing logic           â”‚
â”‚                                                â”‚
â”‚  Port B (Read Side) â”€â”€â–º VGA Controller        â”‚
â”‚  â€¢ Clock: clock_25 (25 MHz)                   â”‚
â”‚  â€¢ Address: [16:0] from VGA scanner           â”‚
â”‚  â€¢ Data Out: 9-bit color                      â”‚
â”‚  â€¢ Read Enable: always on                     â”‚
â”‚                                                â”‚
â”‚  Initialization: black.mif (all zeros)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Address Calculation:
  address = Y Ã— 320 + X
  address = (Y << 8) + (Y << 6) + X    [optimized]
```

## Timing Diagram

```
CLOCK_50:  â”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€
            â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜
            â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
            20ns periods (50 MHz)

clock_25:  â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€
                â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜
                â”‚           â”‚           â”‚
                40ns periods (25 MHz)

PS2_CLK:   â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   (from mouse)    â””â”€â”€â”€â”€â”€â”˜
                   â”‚     â”‚
                   10-40 kHz typical

packet_ready: â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   â””â”€â”˜
                   Pulses when 3 bytes received

vga_write:  â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   â””â”€â”˜ â””â”€â”˜ â””â”€â”˜
                   Active when drawing/erasing
```

## Color Encoding

```
9-bit RGB Color:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ R[2:0]  â”‚ G[2:0]  â”‚ B[2:0]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  3 bits    3 bits    3 bits

Expanded to 8-bit for VGA DAC:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Original  â”‚  VGA Output (8b) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   000      â”‚   00000000       â”‚
â”‚   001      â”‚   00100100       â”‚
â”‚   010      â”‚   01001001       â”‚
â”‚   011      â”‚   01101101       â”‚
â”‚   100      â”‚   10010010       â”‚
â”‚   101      â”‚   10110110       â”‚
â”‚   110      â”‚   11011011       â”‚
â”‚   111      â”‚   11111111       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Used Colors in Project:
â€¢ CURSOR_COLOR = 9'b111_000_000  (Red)
â€¢ DRAW_COLOR   = 9'b111_111_111  (White)
â€¢ ERASE_COLOR  = 9'b000_000_000  (Black)
```

## Coordinate System

```
        0                      319
      0 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚                     â”‚ â”‚
        â”‚ â”‚    Drawing Area     â”‚ â”‚
        â”‚ â”‚                     â”‚ â”‚
        â”‚ â”‚    (320 Ã— 240)      â”‚ â”‚
        â”‚ â”‚                     â”‚ â”‚
        â”‚ â”‚    Center: 160,120  â”‚ â”‚
        â”‚ â”‚         +           â”‚ â”‚
        â”‚ â”‚                     â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    239 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Screen Coordinates:
â€¢ X: 0 to 319 (9 bits)
â€¢ Y: 0 to 239 (8 bits)
â€¢ Origin: Top-left corner
â€¢ Mouse delta_x: positive = right
â€¢ Mouse delta_y: positive = up (inverted in code)

Cursor:
â€¢ Size: 21Ã—21 pixels
â€¢ Shape: Cross-hair (+ pattern)
â€¢ Color: Red (9'b111_000_000)
â€¢ Center offset: -10 pixels in both X and Y

Drawing Brush:
â€¢ Size: 2Ã—2 pixels
â€¢ Draws at cursor position
â€¢ Colors: White (draw) or Black (erase)
```

## PS/2 Mouse Packet Format

```
Byte 0 (Status):
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 7 â”‚ 6 â”‚ 5 â”‚ 4 â”‚ 3 â”‚ 2 â”‚ 1 â”‚ 0 â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚Y_Oâ”‚X_Oâ”‚Y_Sâ”‚X_Sâ”‚ 1 â”‚ M â”‚ R â”‚ L â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
 â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Left button
 â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€ Right button
 â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Middle button
 â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Always 1 (sync bit)
 â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ X sign bit
 â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Y sign bit
 â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ X overflow
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Y overflow

Byte 1: X Movement (0-255)
Byte 2: Y Movement (0-255)

Sign Extension:
â€¢ If X_S = 1: delta_x = {1'b1, X_byte}  (negative)
â€¢ If X_S = 0: delta_x = {1'b0, X_byte}  (positive)
â€¢ Same for Y with Y_S
```

## Resource Allocation

```
FPGA Resources (Cyclone V):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resource           â”‚ Used     â”‚ Total    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Logic Elements     â”‚ ~2,500   â”‚ 32,070   â”‚
â”‚ Memory Bits        â”‚ 691,200  â”‚ 4,065,280â”‚
â”‚ PLLs               â”‚ 1        â”‚ 6        â”‚
â”‚ I/O Pins           â”‚ 84       â”‚ 457      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Memory Breakdown:
â€¢ Video RAM: 691,200 bits (320Ã—240Ã—9)
â€¢ State registers: ~100 bits
â€¢ Counters: ~50 bits
â€¢ PS/2 buffers: ~24 bits

Clock Domains:
â€¢ CLOCK_50 (50 MHz):
  - Drawing state machine
  - PS/2 controller
  - Memory write port
  
â€¢ clock_25 (25 MHz):
  - VGA controller
  - Memory read port
```

## Performance Metrics

```
System Performance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric               â”‚ Value           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cursor Update Rate   â”‚ ~100 Hz         â”‚
â”‚ Mouse Latency        â”‚ 10-20 ms        â”‚
â”‚ VGA Refresh Rate     â”‚ 60 Hz           â”‚
â”‚ Drawing Rate         â”‚ 100 pixels/sec  â”‚
â”‚ Screen Clear Time    â”‚ 1.536 ms        â”‚
â”‚ Max Fmax (estimate)  â”‚ >120 MHz        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Calculations:
â€¢ Screen Clear: 76,800 pixels Ã· 50 MHz = 1.536 ms
â€¢ Cursor Draw: 41 pixels (cross) @ 50 MHz = 0.82 Î¼s
â€¢ Pixel Draw: 4 pixels (2Ã—2) @ 50 MHz = 80 ns
```

## Signal Interface Table

```
Top-Level Port Assignments:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Signal       â”‚ Width â”‚ Direction â”‚ Description            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CLOCK_50     â”‚   1   â”‚ Input     â”‚ 50 MHz system clock    â”‚
â”‚ KEY[3:0]     â”‚   4   â”‚ Input     â”‚ Push buttons (KEY[0]   â”‚
â”‚              â”‚       â”‚           â”‚ is reset)              â”‚
â”‚ SW[9:0]      â”‚  10   â”‚ Input     â”‚ Switches (SW[9] is     â”‚
â”‚              â”‚       â”‚           â”‚ screen clear)          â”‚
â”‚ PS2_CLK      â”‚   1   â”‚ Bidir     â”‚ PS/2 clock line        â”‚
â”‚ PS2_DAT      â”‚   1   â”‚ Bidir     â”‚ PS/2 data line         â”‚
â”‚ VGA_R[7:0]   â”‚   8   â”‚ Output    â”‚ VGA Red channel        â”‚
â”‚ VGA_G[7:0]   â”‚   8   â”‚ Output    â”‚ VGA Green channel      â”‚
â”‚ VGA_B[7:0]   â”‚   8   â”‚ Output    â”‚ VGA Blue channel       â”‚
â”‚ VGA_HS       â”‚   1   â”‚ Output    â”‚ VGA Horizontal Sync    â”‚
â”‚ VGA_VS       â”‚   1   â”‚ Output    â”‚ VGA Vertical Sync      â”‚
â”‚ VGA_BLANK_N  â”‚   1   â”‚ Output    â”‚ VGA Blank (active low) â”‚
â”‚ VGA_SYNC_N   â”‚   1   â”‚ Output    â”‚ VGA Sync (not used)    â”‚
â”‚ VGA_CLK      â”‚   1   â”‚ Output    â”‚ VGA pixel clock        â”‚
â”‚ LEDR[9:0]    â”‚  10   â”‚ Output    â”‚ Red LEDs               â”‚
â”‚ HEX0[6:0]    â”‚   7   â”‚ Output    â”‚ 7-segment display 0    â”‚
â”‚ HEX1[6:0]    â”‚   7   â”‚ Output    â”‚ 7-segment display 1    â”‚
â”‚ HEX2[6:0]    â”‚   7   â”‚ Output    â”‚ 7-segment display 2    â”‚
â”‚ HEX3[6:0]    â”‚   7   â”‚ Output    â”‚ 7-segment display 3    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total I/O Count: 84 pins
```

## Critical Path Analysis

```
Longest Combinational Paths:

1. Mouse Position Update:
   packet_ready â†’ delta_x/y â†’ signed_add â†’ boundary_check â†’ cursor_x/y
   Estimated: ~5 ns @ 50 MHz (plenty of margin)

2. VGA Memory Read:
   vga_x/y â†’ address_translator â†’ memory_read â†’ color_expand â†’ VGA_R/G/B
   Estimated: ~15 ns @ 25 MHz (good timing)

3. Drawing State Machine:
   cursor_pos â†’ bounds_check â†’ vga_address â†’ write_enable
   Estimated: ~8 ns @ 50 MHz (safe)

All paths have positive slack with 50 MHz clock.
```

## Debug Guide

```
LED Indicators:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LED      â”‚ Meaning                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LEDR[0]  â”‚ Left button pressed                 â”‚
â”‚ LEDR[1]  â”‚ Right button pressed                â”‚
â”‚ LEDR[2]  â”‚ Middle button pressed               â”‚
â”‚ LEDR[3]  â”‚ Drawing mode active                 â”‚
â”‚ LEDR[4]  â”‚ Erasing mode active                 â”‚
â”‚ LEDR[5]  â”‚ Mouse packet received (flickers)    â”‚
â”‚ LEDR[6]  â”‚ Screen clearing in progress         â”‚
â”‚ LEDR[7]  â”‚ (unused)                            â”‚
â”‚ LEDR[8]  â”‚ (unused)                            â”‚
â”‚ LEDR[9]  â”‚ (unused)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HEX Displays:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display      â”‚ Shows                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HEX1 HEX0    â”‚ X coordinate (0x000 - 0x13F)    â”‚
â”‚ HEX3 HEX2    â”‚ Y coordinate (0x000 - 0x0EF)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example HEX Reading:
  HEX1=0x01, HEX0=0x0A â†’ X = 0x10A = 266 decimal
  HEX3=0x00, HEX2=0x78 â†’ Y = 0x078 = 120 decimal
```

---

This architecture document provides a comprehensive view of how all the components work together to create a fully functional PS/2 mouse drawing system on the VGA display! ğŸ“

